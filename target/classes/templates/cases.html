<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ëª©ë¡</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .filter-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        .stats {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #4a90e2;
            color: white;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        button, .btn {
            padding: 6px 12px;
            margin: 0 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .btn-primary {
            background-color: #4a90e2;
            color: white;
        }
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .pagination {
            display: flex;
            gap: 5px;
            margin-top: 20px;
            justify-content: center;
        }
        .pagination a, .pagination span {
            padding: 8px 12px;
            border: 1px solid #ddd;
            text-decoration: none;
            color: #333;
        }
        .pagination .active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }
        .badge {
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .badge-draft {
            background-color: #ffc107;
            color: #333;
        }
        .badge-published {
            background-color: #28a745;
            color: white;
        }
        select {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
<div class="header">
    <h1>ğŸ“Š í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ê´€ë¦¬ (DB)</h1>
    <a href="/new" class="btn btn-success">â• ìƒˆ ì¼€ì´ìŠ¤ ìƒì„±</a>
</div>

<div class="stats">
    <strong>ì´ ì¼€ì´ìŠ¤:</strong> <span th:text="${totalItems}">0</span>ê°œ | 
    <strong>í˜ì´ì§€:</strong> <span th:text="${currentPage + 1}">1</span> / <span th:text="${totalPages}">1</span>
</div>

<div class="filter-section">
    <label for="categoryFilter"><strong>ì¹´í…Œê³ ë¦¬:</strong></label>
    <select id="categoryFilter" onchange="filterByCategory(this.value)">
        <option value="">ì „ì²´</option>
        <option th:if="${categories != null}" th:each="cat : ${categories}" 
                th:value="${cat}" 
                th:text="${cat}"
                th:selected="${cat == selectedCategory}"></option>
    </select>
    
    <a href="/migration" class="btn btn-secondary">ğŸ“¦ ë§ˆì´ê·¸ë ˆì´ì…˜</a>
</div>

<table>
    <thead>
        <tr>
            <th style="width: 80px;">ID</th>
            <th>ì œëª©</th>
            <th style="width: 120px;">ì¹´í…Œê³ ë¦¬</th>
            <th style="width: 100px;">ë²„ì „</th>
            <th style="width: 100px;">ìƒíƒœ</th>
            <th style="width: 150px;">ìˆ˜ì •ì¼</th>
            <th style="width: 200px;">ì‘ì—…</th>
        </tr>
    </thead>
    <tbody>
        <tr th:each="testCase : ${cases}">
            <td th:text="${testCase.caseId}">1</td>
            <td>
                <strong th:text="${testCase.title}">ì¼€ì´ìŠ¤ ì œëª©</strong>
                <br/>
                <small th:text="${testCase.note != null ? testCase.note : ''}" style="color: #666;">ë…¸íŠ¸</small>
            </td>
            <td th:text="${testCase.category != null ? testCase.category : '-'}">ì¹´í…Œê³ ë¦¬</td>
            <td th:text="'v' + ${testCase.versionNumber}">v1</td>
            <td>
                <span class="badge" 
                      th:classappend="${testCase.versionStatus == 'PUBLISHED' ? 'badge-published' : 'badge-draft'}"
                      th:text="${testCase.versionStatus}">DRAFT</span>
            </td>
            <td th:text="${testCase.updatedAt != null ? #temporals.format(testCase.updatedAt, 'yyyy-MM-dd HH:mm') : '-'}">2024-01-01</td>
            <td>
                <a th:href="@{/edit/{id}(id=${testCase.caseId})}" class="btn btn-primary">âœï¸ í¸ì§‘</a>
                <form th:action="@{/delete/{id}(id=${testCase.caseId})}" method="post" style="display: inline;" 
                      onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                    <button type="submit" class="btn btn-danger">ğŸ—‘ï¸ ì‚­ì œ</button>
                </form>
            </td>
        </tr>
        <tr th:if="${#lists.isEmpty(cases)}">
            <td colspan="7" style="text-align: center; padding: 40px;">
                ğŸ“­ ë“±ë¡ëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.
            </td>
        </tr>
    </tbody>
</table>

<div class="pagination" th:if="${totalPages > 1}">
    <a th:if="${currentPage > 0}" 
       th:href="@{/cases(page=${currentPage - 1}, category=${selectedCategory})}">Â« ì´ì „</a>
    
    <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
        <a th:if="${i != currentPage}" 
           th:href="@{/cases(page=${i}, category=${selectedCategory})}" 
           th:text="${i + 1}">1</a>
        <span th:if="${i == currentPage}" 
              class="active" 
              th:text="${i + 1}">1</span>
    </span>
    
    <a th:if="${currentPage < totalPages - 1}" 
       th:href="@{/cases(page=${currentPage + 1}, category=${selectedCategory})}">ë‹¤ìŒ Â»</a>
</div>

<script>
function filterByCategory(category) {
    if (category) {
        window.location.href = '/cases?category=' + encodeURIComponent(category);
    } else {
        window.location.href = '/cases';
    }
}
</script>

</body>
</html>
